# car-rental-company-database-sql


Description of the Problem: A car rental company (let's call it CRC) wants to develop a relational database with given data below

1)  "Car" table with 12 columns: CarID (primary key), Make, Model, Year_of_Production, Engine_Size, Fuel_Type, Number_of_Passengers, Registration_Number, Purchase_Price,      Purchase_Date, Rent_Price, and Insurance_Details.

2)  "Garage" table with 5 columns: GarageID (primary key), Garage_Name, Address, Range_of_Services, and Payment_Terms.

3)  "Expenditures" table with 5 columns: ExpenditureID (primary key), Expense_Type, Amount, Date, and Description.

4)  "Revenues" table with 5 columns: RevenueID (primary key), Revenue_Type, Amount, Date, and Description.

5)  "Customer" table with 8 columns: CustomerID (primary key), Name, Address, Telephone_Number, Driving_License_Number, Credit_Card_Details, Booking_Details, and 
     Payment_Method.         

6)  "Car_Garage" table with 3 columns: CarID, GarageID, and a composite primary key of CarID and GarageID, with foreign key references to the CarID and GarageID columns      in the "Car" and "Garage" tables, respectively.

7)  "Customer_Car" table with 3 columns: CustomerID, CarID, and a composite primary key of CustomerID and CarID, with foreign key references to the CustomerID and CarID      columns in the "Customer" and "Car" tables, respectively.

 For Database Diagram we can use SQL Workbench to create the tables and insert a few records into the tables to test queries below.

 ![carRentalCoRELATIONALSCHEMA](https://user-images.githubusercontent.com/111511821/216608777-713252e4-6336-4256-9b17-89eee6f39638.png)

Some queries :

USE carrentalco;

select * from car;
select * from garage;
select * from expenditures;
select * from revenues;
select * from car_garage;
select * from customer_car;

-- Multiple join operations;

-- 1)Joining the Expenditures and Garage tables to find the expenses incurred by each garage:
select car.Make,car.Model,garage.Garage_Name from car
join car_garage on car.CarID = car_garage.CarID
join garage on car_garage.GarageID = garage.GarageID;

-- 2)Joining the Expenditures and Garage tables to find the expenses incurred by each garage:
SELECT customer.Name, SUM(revenues.Amount) AS 'Total_Revenue'
FROM revenues
JOIN Customer_Car ON revenues.RevenueID = Customer_Car.CustomerID
JOIN customer ON Customer_Car.CustomerID = customer.CustomerID
GROUP BY customer.Name;

-- 3)Joining the Expenditures and Garage tables to find the expenses incurred by each garage:
SELECT garage.Garage_Name, SUM(expenditures.Amount) AS 'Total_Expenditure'
FROM expenditures
JOIN garage ON expenditures.ExpenditureID = garage.GarageID
GROUP BY garage.Garage_Name;

-- 4)Joining the Car, Customer, and Revenues tables to find the revenue generated by each car:
SELECT car.Make, car.Model, SUM(revenues.Amount) AS 'Total_Revenues'
FROM car
JOIN Customer_Car ON car.CarID = Customer_Car.CarID
JOIN revenues ON Customer_Car.CustomerID = revenues.RevenueID
GROUP BY car.Make, car.Model;

-- 5)Joining the Car, Customer, and Revenues tables to find the most rented car model:
SELECT Car.Model, COUNT(*) as Rentals
FROM Car
JOIN Customer_Car
ON Car.CarID = Customer_Car.CarID
JOIN Revenues
ON Customer_Car.CustomerID = Revenues.RevenueID
GROUP BY Car.Model
ORDER BY Rentals DESC
LIMIT 1;


-- subqueries single row;
-- 1)Find car with highest engine size:
select Engine_Size from car
where Engine_Size = (select max(Engine_Size) from car);

-- 2)Find car with oldest year of production
select Year_of_Production from car
where Year_of_Production = (select min(Year_of_Production) from car);

-- 3)Find car with highest purchase price
select Purchase_Price from car
where Purchase_Price = (select max(Purchase_Price) from car);

-- 4)Find car with most recent purchase date
select Purchase_Date from car
where Purchase_Date = (select max(Purchase_Date) from car);

-- 5)Find car with highest rent price 
select Rent_Price from car
where Rent_Price = (select max(Rent_Price) from car);

-- subqueries correlated
-- 1)To find the cars with highest purchase price for each make
select car.Make,car.Model,car.Purchase_Price from car
where car.Purchase_Price=(select max(Purchase_Price) from car c2
                           where c2.Make = car.Make);
                           
 -- 2)To find customer who has rented most cars
SELECT Customer.Name
FROM Customer
WHERE (
  SELECT COUNT(*)
  FROM Customer_Car
  WHERE Customer_Car.CustomerID = Customer.CustomerID
) = (
  SELECT MAX(cust_count)
  FROM (
    SELECT CustomerID, COUNT(*) as cust_count
    FROM Customer_Car
    GROUP BY CustomerID
  ) sub
)

        
  -- 3)To find all customers who have rented most expensive car;
SELECT Customer.Name
FROM Customer
WHERE EXISTS (
  SELECT 1
  FROM Customer_Car
  JOIN Car ON Customer_Car.CarID = Car.CarID
  WHERE Customer_Car.CustomerID = Customer.CustomerID
  AND Car.Rent_Price = (
    SELECT MAX(Rent_Price)
    FROM Car
  )
);

             
  -- 4)To find no of expenditure of each type of expense;
SELECT Expense_Type, SUM(Amount)
FROM Expenditures
GROUP BY Expense_Type
HAVING SUM(Amount) = (
  SELECT MAX(sub.expense_total)
  FROM (
    SELECT Expense_Type, SUM(Amount) as expense_total
    FROM Expenditures
    GROUP BY Expense_Type
  ) sub
);

-- 5) To find the garages with the highest range of services:
SELECT Garage_Name, Range_of_Services
FROM Garage
WHERE Range_of_Services = (
  SELECT MAX(Range_of_Services)
  FROM Garage
)

  


-- arthematic and logicaloperatoes;
-- 1)Find total purchase price of all cars
SELECT SUM(Purchase_Price) AS Total_Purchase_Price
FROM Car;

-- 2)Calculate avg rent price for all cars
SELECT AVG(Rent_Price) AS Average_Rent_Price
FROM Car;

-- 3)Find total amount spent on repairs
SELECT SUM(Amount) AS Total_Expenditure_On_Repairs
FROM Expenditures
WHERE Expense_Type = 'Repairs';

-- 4)Find all the cars whose production year is between 2015 to 2018
SELECT * 
FROM Car 
WHERE Year_of_Production < 2015 OR Year_of_Production > 2018;

-- 5)Find all the cars whose production year is not between 2015 to 2018
SELECT * 
FROM Car 
WHERE NOT (Year_of_Production BETWEEN 2015 AND 2018);

-- Clauses;
-- 1)Find the cars and their rent price that have the make as toyota
SELECT Make, Rent_Price
FROM Car
WHERE Make = 'Toyota';

-- 2) find the cars where 5 passangers can be seated
select * from car where Number_of_Passengers='5';




